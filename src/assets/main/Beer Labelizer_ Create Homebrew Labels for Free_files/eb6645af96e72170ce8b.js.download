(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1252:function(e,t,r){"use strict";r.r(t);r(10),r(8),r(52),r(11),r(7),r(12),r(289),r(53),r(15),r(105);var n=r(31),a=r(682),o=r(51),s=r(233),i=r(850),c=r(821),u=r(818),p=r(823),l=r(822),d=r(0),m=r.n(d),f=r(3).c.span.withConfig({displayName:"sku-field__PlanDescription",componentId:"m3hi4f-0"})(["color:",";strong{font-weight:normal;color:",";}"],function(e){return e.theme.textSubColor},function(e){return e.theme.textColor}),y=function SkuField(e){return m.a.createElement(o.i,{caption:"Membership plan",name:"skuId",value:e.form.data.skuId,radios:e.skus.map(function(e){return{value:e.id,caption:m.a.createElement(f,null,m.a.createElement("strong",null,e.name),m.a.createElement("br",null),"USD $",e.price.toFixed(2),e.requiresPlan&&"/month (recurring)")}}),onChange:e.form.onFieldChange})},h=r(18),g=r(834),_=r(287),w=r(156),b=r(869),P=r(238),v=r.n(P),S=r(16),O=r(231),E=r(816),C=r.n(E);function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,a,o,s){try{var i=e[o](s),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function _next(e){asyncGeneratorStep(o,n,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,n,a,_next,_throw,"throw",e)}_next(void 0)})}}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createSuper(e){return function(){var t,r=_getPrototypeOf(e);if(function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;return _assertThisInitialized(e)}(this,t)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var k=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(WrappedSignUpDialog,m.a.PureComponent);var t=_createSuper(WrappedSignUpDialog);function WrappedSignUpDialog(e){var r;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WrappedSignUpDialog),_defineProperty(_assertThisInitialized(r=t.call(this,e)),"getSkus",Object(b.a)(function(){return O.d.filter(function(e){return e.siteId===r.props.site.id})})),_defineProperty(_assertThisInitialized(r),"getPlan",Object(b.a)(function(e){return r.props.site.plans.find(function(t){return t.productSku===e})})),_defineProperty(_assertThisInitialized(r),"getCart",Object(b.a)(function(e,t){var n=u.a.find(function(e){return e.clientId===t}).providerId,a=r.getSkus().find(function(t){return t.id===e});if(a.duration){var o=r.getPlan(a.id).providerPlanIds[n];return{type:"subscription",amount:a.price,planId:o,skuId:a.id}}return{type:"purchase",amount:a.price,items:[{category:a.media,name:a.name,qty:1,skuId:a.id,unitAmount:a.price}]}})),_defineProperty(_assertThisInitialized(r),"validatePaymentForm",function(){var e=[];return r.state.email&&C.a.isEmail(r.state.email)||e.push({name:"email",message:"Please enter your email address"}),r.state.paymentFieldsValid||e.push({name:"paymentFieldsValid",message:"Please enter valid payment info."}),e}),_defineProperty(_assertThisInitialized(r),"processPayment",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee(e){var t;return regeneratorRuntime.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return r.setState({status:"processing",error:null}),ga("send",{hitType:"pageview",page:"/Submit_Payment"}),n.prev=2,n.next=5,Object(w.c)("/api/membership/new",{method:"POST",body:e});case 5:t=n.sent,r.onPurchaseComplete(t.pwrt_uuid),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),n.t0 instanceof w.a?(console.log("PE",n.t0,n.t0.info),r.onPurchaseError(n.t0.info.details)):r.onPurchaseError({});case 12:case"end":return n.stop()}},_callee,null,[[2,9]])}));return function(t){return e.apply(this,arguments)}}()),_defineProperty(_assertThisInitialized(r),"onPurchaseError",function(e){var t;t="already_premium"===e.type?m.a.createElement("span",null,"You already have an account with ",r.props.site.name,". Please"," ",m.a.createElement(S.b,{to:"/login?ret=/account&email="+r.state.email},"sign in")," ","to see your premium membership status."):"There was a problem processing your payment. Please check your information and try again.",r.setState({error:t,status:"payment"})}),_defineProperty(_assertThisInitialized(r),"onPurchaseComplete",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(e){var t,n,a,o,s;return regeneratorRuntime.wrap(function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:t=r.props,n=t.dispatch,a=t.site,o=r.state.skuId,s=r.getSkus().find(function(e){return e.id===o}),ga("send",{hitType:"pageview",page:"/Purchase_Complete"}),ga("ecommerce:addTransaction",{id:r.state.email,affiliation:a.id,revenue:s.price}),gtag("event","purchase",{transaction_id:"",currency:"USD",value:s.price,shipping_tier:"Standard",items:[{index:0,item_id:s.id,item_name:s.name,currency:"USD",price:s.price,quantity:1}]}),fbq("track","Purchase",{value:s.price,currency:"USD",content_category:a.id,content_name:a.name+" "+s.name,num_items:1}),n(h.loadSession()),r.setState({pwrt:e,status:e?"set-password":"done"});case 9:case"end":return i.stop()}},_callee2)}));return function(t){return e.apply(this,arguments)}}()),_defineProperty(_assertThisInitialized(r),"validatePasswordForm",function(){var e=[];return r.state.password||e.push({name:"password",message:"Please enter a password"}),r.state.password.length<8&&e.push({name:"password",message:"Password must be at least 8 characters"}),r.state.confirmPassword!==r.state.password&&e.push({name:"confirmPassword",message:"Passwords must match"}),e}),_defineProperty(_assertThisInitialized(r),"setPassword",_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(w.c)("/api/users/reset-password/"+r.state.pwrt,{method:"POST",body:{password:r.state.password,confirm_password:r.state.confirmPassword}});case 3:r.setState({status:"done"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),r.setState({error:"An error occurred while trying to set your password. Please try again."});case 9:case"end":return e.stop()}},_callee3,null,[[0,6]])}))),_defineProperty(_assertThisInitialized(r),"finish",function(){r.props.history.push("/")}),_defineProperty(_assertThisInitialized(r),"close",function(){r.props.history.push("/")});var n=v.a.parse(window.location.search.slice(1));return r.state={status:"payment",paymentsClientId:u.a[0].clientId,paymentFieldsValid:!1,autoRenew:!0,skuId:n.skuId||r.getSkus()[0].id,email:e.me.email||"",password:"",confirmPassword:""},r.setState=r.setState.bind(_assertThisInitialized(r)),r}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(WrappedSignUpDialog,[{key:"componentDidMount",value:function componentDidMount(){ga("send",{hitType:"pageview",page:"/Signup_Modal"})}},{key:"render",value:function render(){var e=this,t=this.getCart(this.state.skuId,this.state.paymentsClientId);return m.a.createElement(a.a,{title:"Sign up to print at home",onClose:this.close},("payment"===this.state.status||"processing"===this.state.status)&&m.a.createElement(o.e,{data:this.state,onChange:this.setState,onValidate:this.validatePaymentForm,lastSubmitError:this.state.error},function(r){return m.a.createElement(m.a.Fragment,null,m.a.createElement(y,{skus:e.getSkus(),form:r}),m.a.createElement(c.a,{form:r}),m.a.createElement(i.PaymentsController,{paymentClientId:e.state.paymentsClientId,processOnSubmit:!0},m.a.createElement(o.p,{caption:"Email",name:"email",value:r.data.email,error:r.errors.email,onChange:r.onFieldChange,readOnly:!!e.props.me.email}),m.a.createElement(p.a,{showErrors:r.showErrors,onValidChanged:function onValidChanged(t){return e.setState({paymentFieldsValid:t})}}),m.a.createElement(l.b,{busy:"processing"===e.state.status,form:r,email:r.data.email,cart:t,onAccepted:e.processPayment,onError:function onError(t){return e.setState({error:t.message})}})))}),"set-password"===this.state.status&&m.a.createElement(o.e,{data:this.state,onChange:this.setState,onValidate:this.validatePasswordForm,lastSubmitError:this.state.error},function(t){return m.a.createElement("div",null,m.a.createElement("p",null,"Please choose a password for your new premium account:"),m.a.createElement(o.p,{caption:"New password",name:"password",value:t.data.password,error:t.errors.password,type:"password",onChange:t.onFieldChange}),m.a.createElement(o.p,{caption:"Confirm password",name:"confirmPassword",value:t.data.confirmPassword,error:t.errors.confirmPassword,type:"password",onChange:t.onFieldChange}),m.a.createElement(o.m,{label:"Set Password",busy:!1,errorMessage:t.errorMessage,preSubmit:t.preSubmit,onSubmit:e.setPassword}))}),"done"===this.state.status&&m.a.createElement("div",null,m.a.createElement("p",null,"Great news. Your account has been set up successfully and we've logged you in so you are ready to go."),m.a.createElement("p",null,"We've also emailed your account details to"," ",m.a.createElement("strong",null,this.state.email)," for your future reference."),m.a.createElement(n.b,{onClick:this.finish},"OK")))}},{key:"componentDidUpdate",value:function componentDidUpdate(e){!e.me.email&&this.props.me.email&&this.setState({email:this.props.me.email})}}]),WrappedSignUpDialog}();t.default=Object(s.b)(Object(g.a)(Object(_.a)(k)))},682:function(e,t,r){"use strict";var n=r(288);t.a=n.b},834:function(e,t,r){"use strict";r.d(t,"a",function(){return withMe});r(47),r(8),r(25),r(28),r(7),r(38);var n=r(32);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function withMe(e){return Object(n.b)(function(e,t){return function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},t,{me:e.app.me})})(e)}}}]);
//# sourceMappingURL=eb6645af96e72170ce8b.js.map